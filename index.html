<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Processos | Gestão Jurídica</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
            padding: 24px 32px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .logo {
            background: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header-title {
            color: white;
            font-size: 24px;
            font-weight: 700;
        }
        
        .header-subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 13px;
            margin-top: 2px;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: white;
            color: #0ea5e9;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn-green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .header-badge {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            font-size: 13px;
            font-weight: 600;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #0ea5e9 0%, #06b6d4 100%);
        }
        
        .stat-card.green::before {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }
        
        .stat-card.teal::before {
            background: linear-gradient(90deg, #14b8a6 0%, #0d9488 100%);
        }
        
        .stat-card.blue::before {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
            color: white;
        }
        
        .stat-card.green .stat-icon {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .stat-card.teal .stat-icon {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
        }
        
        .stat-card.blue .stat-icon {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        
        .stat-label {
            font-size: 12px;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
        }
        
        .stat-subtitle {
            font-size: 13px;
            color: #94a3b8;
        }
        
        .filters-section {
            background: white;
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
            color: white;
            font-size: 18px;
        }
        
        .section-icon.green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #0f172a;
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
        }
        
        .filter-item label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #475569;
            margin-bottom: 8px;
        }
        
        select, input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            color: #1e293b;
            background: white;
            transition: all 0.2s;
        }
        
        select:hover, input:hover {
            border-color: #cbd5e1;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        .chart-section {
            background: white;
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin-top: 20px;
        }
        
        .chart-note {
            font-size: 13px;
            color: #64748b;
            margin-top: 16px;
            text-align: center;
            font-style: italic;
        }
        
        .table-section {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        thead {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
        }
        
        th {
            padding: 16px 20px;
            text-align: left;
            color: white;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        th:first-child {
            border-top-left-radius: 12px;
        }
        
        th:last-child {
            border-top-right-radius: 12px;
        }
        
        td {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        tbody tr:hover {
            background: #f8fafc;
        }
        
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-liquidacao {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-execucao {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-acordo {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-calculos {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-actions {
                width: 100%;
            }
            
            .btn {
                flex: 1;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 250px;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo">⚖️</div>
                <div>
                    <div class="header-title">Dashboard Processos Trabalhistas</div>
                    <div class="header-subtitle">Gestão Jurídica Consolidada</div>
                </div>
            </div>
            
            <div class="header-actions">
                <button class="btn" onclick="exportarExcel()">
                    <i class="fas fa-file-excel"></i>
                    Excel
                </button>
                <button class="btn" onclick="exportarPDFGeral()">
                    <i class="fas fa-file-pdf"></i>
                    PDF Geral
                </button>
                <button class="btn btn-green" onclick="exportarPDFKalunga()">
                    <i class="fas fa-calendar-alt"></i>
                    PDF Kalunga
                </button>
            </div>
            
            <div class="header-badge">
                <i class="fas fa-sync-alt"></i>
                Atualizado: 23/10/2025
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Total de Processos</div>
                        <div class="stat-value" id="statTotal">27</div>
                        <div class="stat-subtitle">Em andamento</div>
                    </div>
                    <div class="stat-icon"><i class="fas fa-folder-open"></i></div>
                </div>
            </div>
            
            <div class="stat-card green">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Valor Total</div>
                        <div class="stat-value" id="statValor">—</div>
                        <div class="stat-subtitle">Soma consolidada</div>
                    </div>
                    <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                </div>
            </div>
            
            <div class="stat-card teal">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Honorários Totais</div>
                        <div class="stat-value" id="statHonorarios">—</div>
                        <div class="stat-subtitle">Receita estimada</div>
                    </div>
                    <div class="stat-icon"><i class="fas fa-hand-holding-usd"></i></div>
                </div>
            </div>
            
            <div class="stat-card blue">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Ticket Médio</div>
                        <div class="stat-value" id="statTicket">—</div>
                        <div class="stat-subtitle">Por processo</div>
                    </div>
                    <div class="stat-icon"><i class="fas fa-calculator"></i></div>
                </div>
            </div>
        </div>
        
        <div class="filters-section">
            <div class="section-header">
                <div class="section-icon"><i class="fas fa-filter"></i></div>
                <div class="section-title">Filtros</div>
            </div>
            <div class="filters-grid">
                <div class="filter-item">
                    <label>Cliente</label>
                    <select id="filtroCliente" onchange="aplicarFiltros()">
                        <option value="todos">Todos os Clientes</option>
                        <option value="ZAMP S.A.">ZAMP S.A.</option>
                        <option value="Verisure Brasil">Verisure Brasil</option>
                        <option value="Kalunga S.A.">Kalunga S.A.</option>
                        <option value="Arcos Dourados (McDonald's)">Arcos Dourados</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label>Fase do Processo</label>
                    <select id="filtroFase" onchange="aplicarFiltros()">
                        <option value="todas">Todas as Fases</option>
                        <option value="Liquidação">Liquidação</option>
                        <option value="Cálculos">Cálculos</option>
                        <option value="Acordo">Acordo</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label>Buscar Reclamante</label>
                    <input type="text" id="filtroBusca" placeholder="Digite o nome..." oninput="aplicarFiltros()">
                </div>
            </div>
        </div>
        
        <div class="chart-section">
            <div class="section-header">
                <div class="section-icon green"><i class="fas fa-chart-line"></i></div>
                <div class="section-title">Projeção de Caixa - Kalunga (Próximos 12 meses)</div>
            </div>
            <div class="chart-container">
                <canvas id="chartProjecao"></canvas>
            </div>
            <div class="chart-note">
                * Projeção considera apenas parcelas a vencer dos acordos Kalunga
            </div>
        </div>
        
        <div class="table-section">
            <div class="section-header">
                <div class="section-icon"><i class="fas fa-table"></i></div>
                <div class="section-title">Processos Detalhados</div>
            </div>
            <table id="tabelaProcessos">
                <thead>
                    <tr>
                        <th>Reclamante</th>
                        <th>Cliente</th>
                        <th>Processo</th>
                        <th>Fase</th>
                        <th>Valor Líquido</th>
                        <th>Hon. Contratuais</th>
                        <th>Hon. Sucumbenciais</th>
                        <th>Total Honorários</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela"></tbody>
            </table>
        </div>
    </div>
    
    <script>
        const processos = [
            {"reclamante":"MATHEUS TARCISIO DE MESQUITA RODRIGUES","cliente":"ZAMP S.A.","processo":"1000366-79.2025.5.02.0611","fase":"Liquidação","valor_liquido":329984.12,"hon_contratuais":98995.24,"hon_sucumbenciais":17788.14,"data_liquidacao":"09/2025"},
            {"reclamante":"ADRIANO MARQUES DA SILVA","cliente":"ZAMP S.A.","processo":"1000123-45.2023.5.02.0001","fase":"Liquidação","valor_liquido":98995.24,"hon_contratuais":29698.57,"hon_sucumbenciais":5000.0,"data_liquidacao":"09/2025"},
            {"reclamante":"CAMILLA SANTOS CRUZ","cliente":"ZAMP S.A.","processo":"1000234-56.2022.5.02.0002","fase":"Liquidação","valor_liquido":135627.58,"hon_contratuais":40688.27,"hon_sucumbenciais":7000.0,"data_liquidacao":"02/2023"},
            {"reclamante":"ARIEL CRISTINE NEVES DA SILVA","cliente":"ZAMP S.A.","processo":"1000345-67.2021.5.02.0003","fase":"Liquidação","valor_liquido":46650.04,"hon_contratuais":13995.01,"hon_sucumbenciais":3000.0,"data_liquidacao":"07/2023"},
            {"reclamante":"NAYARA OLIVEIRA DA CRUZ","cliente":"ZAMP S.A.","processo":"1000456-78.2020.5.02.0004","fase":"Liquidação","valor_liquido":135627.58,"hon_contratuais":40688.27,"hon_sucumbenciais":7000.0,"data_liquidacao":"08/2022"},
            {"reclamante":"ALEX VIEIRA MACIEL","cliente":"ZAMP S.A.","processo":"1000567-89.2021.5.02.0005","fase":"Liquidação","valor_liquido":152557.99,"hon_contratuais":45767.4,"hon_sucumbenciais":8000.0,"data_liquidacao":"06/2023"},
            {"reclamante":"DANIEL MARSANO","cliente":"ZAMP S.A.","processo":"1000678-90.2019.5.02.0006","fase":"Liquidação","valor_liquido":18105.29,"hon_contratuais":5431.59,"hon_sucumbenciais":1000.0,"data_liquidacao":"04/2020"},
            {"reclamante":"MICHELE CRISTINA","cliente":"ZAMP S.A.","processo":"1000789-01.2022.5.02.0007","fase":"Liquidação","valor_liquido":13578.95,"hon_contratuais":4073.69,"hon_sucumbenciais":800.0,"data_liquidacao":"03/2023"},
            {"reclamante":"GILBERTO ALVES","cliente":"ZAMP S.A.","processo":"1000890-12.2021.5.02.0008","fase":"Liquidação","valor_liquido":11689.78,"hon_contratuais":3506.93,"hon_sucumbenciais":700.0,"data_liquidacao":"03/2022"},
            {"reclamante":"JONATHAN ALVES BARBOSA LINS DA SILVA","cliente":"ZAMP S.A.","processo":"0011416-96.2022.5.15.0083","fase":"Liquidação","valor_liquido":68462.08,"hon_contratuais":20538.62,"hon_sucumbenciais":8798.14,"data_liquidacao":"05/2025"},
            {"reclamante":"DANIEL JUNIOR RIBEIRO","cliente":"ZAMP S.A.","processo":"0011399-10.2022.5.15.0132","fase":"Liquidação","valor_liquido":226329.59,"hon_contratuais":67898.88,"hon_sucumbenciais":35554.49,"data_liquidacao":"09/2024"},
            {"reclamante":"WENDELL GUSTAVO BRITO SILVA","cliente":"ZAMP S.A.","processo":"0010150-22.2024.5.15.0013","fase":"Cálculos","valor_liquido":72751.42,"hon_contratuais":21825.43,"hon_sucumbenciais":7275.14,"data_liquidacao":"03/2025"},
            {"reclamante":"RODRIGO GOMES","cliente":"Verisure Brasil","processo":"1001000-00.2024.5.02.0100","fase":"Liquidação","valor_liquido":202070.31,"hon_contratuais":60621.09,"hon_sucumbenciais":10000.0,"data_liquidacao":"02/2025"},
            {"reclamante":"BRUNA ALVES LEÃO","cliente":"Verisure Brasil","processo":"1001111-11.2024.5.02.0101","fase":"Liquidação","valor_liquido":216016.74,"hon_contratuais":64805.02,"hon_sucumbenciais":11000.0,"data_liquidacao":"02/2025"},
            {"reclamante":"RODRIGO DE QUEIROZ","cliente":"Verisure Brasil","processo":"1001349-26.2025.5.02.0014","fase":"Cálculos","valor_liquido":367766.18,"hon_contratuais":110329.85,"hon_sucumbenciais":39645.66,"data_liquidacao":"04/2023"},
            {"reclamante":"ADRIANO JOSÉ","cliente":"Verisure Brasil","processo":"1001222-22.2020.5.02.0102","fase":"Liquidação","valor_liquido":70000.0,"hon_contratuais":21000.0,"hon_sucumbenciais":3500.0,"data_liquidacao":"04/2021"},
            {"reclamante":"FLAVIANA MORORO","cliente":"Verisure Brasil","processo":"1001333-33.2022.5.02.0103","fase":"Liquidação","valor_liquido":150000.0,"hon_contratuais":45000.0,"hon_sucumbenciais":7500.0,"data_liquidacao":"05/2023"},
            {"reclamante":"BRUNA KEZAM PELEGRINO LOYOLA","cliente":"Verisure Brasil","processo":"1001444-44.2023.5.02.0104","fase":"Liquidação","valor_liquido":80000.0,"hon_contratuais":24000.0,"hon_sucumbenciais":4000.0,"data_liquidacao":"06/2024"},
            {"reclamante":"ROBERTA ADELINO GUALBERTO","cliente":"Verisure Brasil","processo":"1001555-55.2023.5.02.0105","fase":"Liquidação","valor_liquido":60000.0,"hon_contratuais":18000.0,"hon_sucumbenciais":3000.0,"data_liquidacao":"07/2024"},
            {"reclamante":"ANA HIPÓLITO","cliente":"Verisure Brasil","processo":"1001666-66.2024.5.02.0106","fase":"Cálculos","valor_liquido":49439.61,"hon_contratuais":14831.88,"hon_sucumbenciais":2500.0,"data_liquidacao":"08/2024"},
            {"reclamante":"CHARLES LEO SILVA","cliente":"Verisure Brasil","processo":"0010404-66.2022.5.15.0109","fase":"Cálculos","valor_liquido":19543.27,"hon_contratuais":5862.98,"hon_sucumbenciais":2020.68,"data_liquidacao":"10/2025"},
            {"reclamante":"LEONARDO CRUZ LIMA","cliente":"Kalunga S.A.","processo":"1000375-56.2025.5.02.0703","fase":"Acordo","valor_liquido":60000.0,"hon_contratuais":18000.0,"hon_sucumbenciais":0,"data_liquidacao":"03/2025","parcelamentoDetalhado":{"fonte":"1000375-56.2025.5.02.0703","parcelas":[{"due":"2025-06-05","valor":5000.0,"num":1},{"due":"2025-07-07","valor":5000.0,"num":2},{"due":"2025-08-05","valor":5000.0,"num":3},{"due":"2025-09-05","valor":5000.0,"num":4},{"due":"2025-10-06","valor":5000.0,"num":5},{"due":"2025-11-05","valor":5000.0,"num":6},{"due":"2025-12-05","valor":5000.0,"num":7},{"due":"2026-01-05","valor":5000.0,"num":8},{"due":"2026-02-05","valor":5000.0,"num":9},{"due":"2026-03-05","valor":5000.0,"num":10},{"due":"2026-04-06","valor":5000.0,"num":11},{"due":"2026-05-05","valor":5000.0,"num":12}]}},
            {"reclamante":"RICHARD OLIVEIRA DOMINGUES","cliente":"Kalunga S.A.","processo":"1001114-38.2025.5.02.0603","fase":"Acordo","valor_liquido":50000.3,"hon_contratuais":15000.09,"hon_sucumbenciais":0,"data_liquidacao":"05/2025","parcelamentoDetalhado":{"fonte":"1001114-38.2025.5.02.0603","parcelas":[{"due":"2025-08-18","valor":5000.03,"num":1},{"due":"2025-09-18","valor":5000.03,"num":2},{"due":"2025-10-20","valor":5000.03,"num":3},{"due":"2025-11-18","valor":5000.03,"num":4},{"due":"2025-12-18","valor":5000.03,"num":5},{"due":"2026-01-20","valor":5000.03,"num":6},{"due":"2026-02-18","valor":5000.03,"num":7},{"due":"2026-03-18","valor":5000.03,"num":8},{"due":"2026-04-20","valor":5000.03,"num":9},{"due":"2026-05-18","valor":5000.03,"num":10}]}},
            {"reclamante":"VITOR DE OLIVEIRA SILVA","cliente":"Kalunga S.A.","processo":"1001405-59.2025.5.02.0014","fase":"Acordo","valor_liquido":71000.0,"hon_contratuais":21300.0,"hon_sucumbenciais":0,"data_liquidacao":"10/2024","parcelamentoDetalhado":{"fonte":"1001405-59.2025.5.02.0014","parcelas":[{"due":"2025-10-22","valor":6454.55,"num":1},{"due":"2025-11-24","valor":6454.55,"num":2},{"due":"2025-12-22","valor":6454.55,"num":3},{"due":"2026-01-22","valor":6454.55,"num":4},{"due":"2026-02-23","valor":6454.55,"num":5},{"due":"2026-03-23","valor":6454.55,"num":6},{"due":"2026-04-22","valor":6454.54,"num":7},{"due":"2026-05-22","valor":6454.54,"num":8},{"due":"2026-06-22","valor":6454.54,"num":9},{"due":"2026-07-22","valor":6454.54,"num":10},{"due":"2026-08-24","valor":6454.54,"num":11}]}},
            {"reclamante":"EMERSON DA SILVA RAMOS","cliente":"Kalunga S.A.","processo":"1001760-18.2025.5.02.0613","fase":"Acordo","valor_liquido":70000.0,"hon_contratuais":21000.0,"hon_sucumbenciais":0,"data_liquidacao":"09/2024","parcelamentoDetalhado":{"fonte":"1001760-18.2025.5.02.0613","parcelas":[{"due":"2025-10-17","valor":5833.34,"num":1},{"due":"2025-11-17","valor":5833.34,"num":2},{"due":"2025-12-17","valor":5833.34,"num":3},{"due":"2026-01-19","valor":5833.33,"num":4},{"due":"2026-02-17","valor":5833.33,"num":5},{"due":"2026-03-17","valor":5833.33,"num":6},{"due":"2026-04-17","valor":5833.33,"num":7},{"due":"2026-05-18","valor":5833.33,"num":8},{"due":"2026-06-17","valor":5833.33,"num":9},{"due":"2026-07-17","valor":5833.33,"num":10},{"due":"2026-08-17","valor":5833.33,"num":11},{"due":"2026-09-17","valor":5833.33,"num":12}]}},
            {"reclamante":"LUCAS DOS SANTOS DE ALMEIDA","cliente":"Kalunga S.A.","processo":"1001450-34.2024.5.02.0035","fase":"Acordo","valor_liquido":40834.25,"hon_contratuais":12250.28,"hon_sucumbenciais":0,"data_liquidacao":"04/2025"},
            {"reclamante":"JAQUELINE CASADO OLIVEIRA","cliente":"Arcos Dourados (McDonald's)","processo":"0011635-72.2023.5.15.0084","fase":"Acordo","valor_liquido":50000.4,"hon_contratuais":15000.12,"hon_sucumbenciais":500.0,"data_liquidacao":"07/2025"}
        ];
        
        let processosFiltrados = [...processos];
        let chartProjecao = null;
        
        function formatarReal(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2
            }).format(valor);
        }
        
        function formatarRealCompacto(valor) {
            if (valor >= 1000000) {
                return 'R$ ' + (valor / 1000000).toFixed(1) + 'M';
            } else if (valor >= 1000) {
                return 'R$ ' + (valor / 1000).toFixed(0) + 'k';
            }
            return formatarReal(valor);
        }
        
        function calcularProjecaoMensal() {
            const hoje = new Date('2025-10-23');
            const mesesProjecao = [];
            
            // Gerar próximos 12 meses
            for (let i = 0; i < 12; i++) {
                const data = new Date(hoje);
                data.setMonth(data.getMonth() + i);
                const mesAno = `${data.getFullYear()}-${String(data.getMonth() + 1).padStart(2, '0')}`;
                const mesLabel = data.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' }).replace('.', '');
                mesesProjecao.push({ mesAno, mesLabel, valor: 0 });
            }
            
            // Somar parcelas por mês
            processosFiltrados.forEach(proc => {
                if (proc.parcelamentoDetalhado && proc.parcelamentoDetalhado.parcelas) {
                    proc.parcelamentoDetalhado.parcelas.forEach(parcela => {
                        const dataParcela = new Date(parcela.due);
                        if (dataParcela >= hoje) {
                            const mesAno = `${dataParcela.getFullYear()}-${String(dataParcela.getMonth() + 1).padStart(2, '0')}`;
                            const mes = mesesProjecao.find(m => m.mesAno === mesAno);
                            if (mes) {
                                mes.valor += parcela.valor;
                            }
                        }
                    });
                }
            });
            
            return mesesProjecao;
        }
        
        function atualizarGraficoProjecao() {
            const projecao = calcularProjecaoMensal();
            const ctx = document.getElementById('chartProjecao');
            
            if (chartProjecao) {
                chartProjecao.destroy();
            }
            
            chartProjecao = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: projecao.map(m => m.mesLabel),
                    datasets: [{
                        label: 'Valor Previsto',
                        data: projecao.map(m => m.valor),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Valor: ' + formatarReal(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatarRealCompacto(value);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarCards() {
            const total = processosFiltrados.length;
            const valorTotal = processosFiltrados.reduce((sum, p) => sum + p.valor_liquido, 0);
            const honTotal = processosFiltrados.reduce((sum, p) => sum + p.hon_contratuais + p.hon_sucumbenciais, 0);
            const ticketMedio = total > 0 ? valorTotal / total : 0;
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statValor').textContent = formatarRealCompacto(valorTotal);
            document.getElementById('statHonorarios').textContent = formatarRealCompacto(honTotal);
            document.getElementById('statTicket').textContent = formatarRealCompacto(ticketMedio);
        }
        
        function atualizarTabela() {
            const tbody = document.getElementById('corpoTabela');
            tbody.innerHTML = '';
            
            processosFiltrados.forEach(proc => {
                const tr = document.createElement('tr');
                const totalHon = proc.hon_contratuais + proc.hon_sucumbenciais;
                
                let badgeClass = 'badge-liquidacao';
                if (proc.fase === 'Acordo') badgeClass = 'badge-acordo';
                else if (proc.fase === 'Cálculos') badgeClass = 'badge-calculos';
                
                tr.innerHTML = `
                    <td style="font-weight: 600;">${proc.reclamante}</td>
                    <td>${proc.cliente}</td>
                    <td style="font-size: 12px; color: #64748b;">${proc.processo}</td>
                    <td><span class="badge ${badgeClass}">${proc.fase}</span></td>
                    <td style="font-weight: 600;">${formatarReal(proc.valor_liquido)}</td>
                    <td>${formatarReal(proc.hon_contratuais)}</td>
                    <td>${formatarReal(proc.hon_sucumbenciais)}</td>
                    <td style="font-weight: 700; color: #059669;">${formatarReal(totalHon)}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function aplicarFiltros() {
            const filtroCliente = document.getElementById('filtroCliente').value;
            const filtroFase = document.getElementById('filtroFase').value;
            const filtroBusca = document.getElementById('filtroBusca').value.toLowerCase();
            
            processosFiltrados = processos.filter(proc => {
                const matchCliente = filtroCliente === 'todos' || proc.cliente === filtroCliente;
                const matchFase = filtroFase === 'todas' || proc.fase === filtroFase;
                const matchBusca = filtroBusca === '' || proc.reclamante.toLowerCase().includes(filtroBusca);
                
                return matchCliente && matchFase && matchBusca;
            });
            
            atualizarCards();
            atualizarTabela();
            atualizarGraficoProjecao();
        }
        
        function exportarExcel() {
            const dados = processosFiltrados.map(proc => ({
                'Reclamante': proc.reclamante,
                'Cliente': proc.cliente,
                'Processo': proc.processo,
                'Fase': proc.fase,
                'Valor Líquido': proc.valor_liquido,
                'Hon. Contratuais': proc.hon_contratuais,
                'Hon. Sucumbenciais': proc.hon_sucumbenciais,
                'Total Honorários': proc.hon_contratuais + proc.hon_sucumbenciais,
                'Data Liquidação': proc.data_liquidacao
            }));
            
            const ws = XLSX.utils.json_to_sheet(dados);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Processos");
            XLSX.writeFile(wb, "processos_trabalhistas.xlsx");
        }
        
        function exportarPDFGeral() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            
            doc.setFontSize(18);
            doc.text('Relatório Geral - Processos Trabalhistas', 14, 20);
            
            doc.setFontSize(11);
            doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 14, 28);
            
            const total = processosFiltrados.length;
            const valorTotal = processosFiltrados.reduce((sum, p) => sum + p.valor_liquido, 0);
            const honTotal = processosFiltrados.reduce((sum, p) => sum + p.hon_contratuais + p.hon_sucumbenciais, 0);
            
            doc.text(`Total de Processos: ${total}`, 14, 36);
            doc.text(`Valor Total: ${formatarReal(valorTotal)}`, 14, 42);
            doc.text(`Honorários Totais: ${formatarReal(honTotal)}`, 14, 48);
            
            const tableData = processosFiltrados.map(proc => [
                proc.reclamante,
                proc.cliente,
                proc.fase,
                formatarReal(proc.valor_liquido),
                formatarReal(proc.hon_contratuais + proc.hon_sucumbenciais)
            ]);
            
            doc.autoTable({
                startY: 55,
                head: [['Reclamante', 'Cliente', 'Fase', 'Valor Líquido', 'Total Hon.']],
                body: tableData,
                theme: 'grid',
                headStyles: { fillColor: [14, 165, 233] },
                styles: { fontSize: 9 }
            });
            
            doc.save('relatorio_processos.pdf');
        }
        
        function exportarPDFKalunga() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            
            doc.setFontSize(18);
            doc.text('Projeção de Parcelas - Kalunga S.A.', 14, 20);
            
            doc.setFontSize(11);
            doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 14, 28);
            
            // Resumo mensal
            const projecao = calcularProjecaoMensal();
            const totalProjecao = projecao.reduce((sum, m) => sum + m.valor, 0);
            
            doc.setFontSize(14);
            doc.text('Resumo Mensal (Próximos 12 meses)', 14, 38);
            
            const resumoData = projecao.map(m => [
                m.mesLabel,
                formatarReal(m.valor)
            ]);
            
            doc.autoTable({
                startY: 43,
                head: [['Mês', 'Valor Previsto']],
                body: resumoData,
                theme: 'grid',
                headStyles: { fillColor: [16, 185, 129] },
                styles: { fontSize: 9 },
                columnStyles: {
                    1: { halign: 'right' }
                }
            });
            
            let currentY = doc.lastAutoTable.finalY + 10;
            
            // Detalhamento por processo
            const processosKalunga = processosFiltrados.filter(p => 
                p.cliente === 'Kalunga S.A.' && p.parcelamentoDetalhado
            );
            
            processosKalunga.forEach((proc, index) => {
                if (currentY > 180) {
                    doc.addPage();
                    currentY = 20;
                }
                
                doc.setFontSize(12);
                doc.text(`${proc.reclamante} - Processo: ${proc.processo}`, 14, currentY);
                currentY += 5;
                
                const hoje = new Date('2025-10-23');
                const parcelasFuturas = proc.parcelamentoDetalhado.parcelas.filter(p => 
                    new Date(p.due) >= hoje
                );
                
                const parcelasData = parcelasFuturas.map(p => [
                    `${p.num}/${proc.parcelamentoDetalhado.parcelas.length}`,
                    new Date(p.due).toLocaleDateString('pt-BR'),
                    formatarReal(p.valor)
                ]);
                
                doc.autoTable({
                    startY: currentY,
                    head: [['Parcela', 'Vencimento', 'Valor']],
                    body: parcelasData,
                    theme: 'striped',
                    headStyles: { fillColor: [16, 185, 129] },
                    styles: { fontSize: 9 },
                    columnStyles: {
                        2: { halign: 'right' }
                    }
                });
                
                currentY = doc.lastAutoTable.finalY + 10;
            });
            
            doc.save('parcelas_kalunga.pdf');
        }
        
        // Inicializar
        aplicarFiltros();
    </script>
</body>
</html>

